
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>CakePHP e MongoDB</title>
    
    <meta name="author" content="Name Lastname">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">Jekyll Bootstrap</a>
          <ul class="nav">
            
            
            


  
    
    	
    	<li><a href="/categories.html">Categories</a></li>
    	
    
  
    
    	
    	<li><a href="/tags.html">Tags</a></li>
    	
    
  
    
  
    
  
    
    	
    	<li><a href="/pages.html">Pages</a></li>
    	
    
  
    
    	
    	<li><a href="/archive.html">Archive</a></li>
    	
    
  
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="page-header">
  <h1>CakePHP e MongoDB <small>Supporting tagline</small></h1>
</div>

<div class="row">
  <div class="span8">
    Piccola premessa, non tutte le applicazioni possono ricevere vantaggi dall'utilizzo di mongodb.
Alcune caratteristiche di MongoDb:
-&Egrave; scritto in c
-Schema Free!! non necessita di uno schema fisso, ogni record ha il proprio schema. Inoltre, non dobbiamo definire nulla prima di inserire.
- salva i campi ogni volta che salvi un record, quindi campi corti riducono il peso del vostro database (o collection)
Queste le caratteristiche di MongoDB:
-Embedded Objects. Se ho un record (o document, come vedremo poi, la terminologia in mongo db varia da quella di mysql) contenente uno user con il campo "address", il campo "address" puo' essere definito dal document Address, con una via ed un numero civico. Accoppiare gli oggetti User e Address assomiglia a fare una join fra le due tabelle in mysql.

<strong>Non va bene per</strong>:
-Apllicazioni che necessitano funzioni di Join o Transaction.
-Server con poco spazio, questo avviene perchè ogni valore viene salvato con la propria label. Un normale database Mysql è più leggero.
<strong> Va bene per:</strong>
-Applicazioni che richiedono velocità in scrittura e lettura
-Applicazioni che richiedono buona scalabilità

Installiamo php5-dev. Dopo di che lanciamo dalla console
[bash]pecl install mongo[/bash].  Se utilizzate windows...be, vi attaccate.
Modificate il vostro /etc/php5/apache2/php.ini e inserite nella sezione delle extensions la seguente linea [bash]extension=mongo.so[/bash]
Riavviate apache. A questo link potete trovare il pratico <a href="http://us2.php.net/mongo">manuale di mongo su php</a>.
Ora, spostatevi nell'applicazione in cui volete utilizzare mongo db, e scaricatevi il plugin dello sviluppatore giapponese Ichikawa. <a href="http://cake.eizoku.com/blog/">Ichikawa</a> spacca, qui il <a href="http://tv.cakephp.org/video/CakeFoundation/2010/12/24/yasushi_ichikawa_-_how_to_use_mongodb_with_cakephp">video</a> dal quale è tratto questo tutorial.
[bash]
cd app/plugins
git clone http://github.com/ichikaway/mongoDB-Datasource.git mongodb
[/bash]
poi, modifichiamo il file app/config/database.php con dei dati fittizi.
[php]	var $default = array(
'driver' =&gt; 'mongodb.mongodbSource',
'password' =&gt; 'password',
'database' =&gt; 'cakemongo1',
'port' =&gt; '27017',
);
[/php]
Ora, copiamo le cartelle views, controllers e models presenti in /app/plugins/mongodb/samples  in app. Aprite Il file app/models/post.php e decommentate la variabile mongoSchema. Apriamo il nostro  browser a questo indirizzo <a href="http://localhost/posts">http://localhost/posts</a> e clicchiamo su "add data" andando cosi' ad aggiungere il primo "document" (in mongodb row diventa document, column diventa field e database collection. Per altri preziosi parallelismi com mysql, date un occhio a <a href="http://www.mongodb.org/display/DOCS/SQL+to+Mongo+Mapping+Chart">Sql to Mongo Mapping chart</a>).
Ora da console controlliamo i dati inseriti.

[bash]
da@lungimiranza:~$ mongo
show dbs
use cakemongo1
show collections
db.posts.find()
[/bash]

Come risultato otteremo qualcosa di simile
[bash]
{ "_id" : ObjectId("4d1a0a4776aa08bb22000000"), "title" : "regfwerg", "body" : "ertgertg", "hoge" : "ertgertg", "modified" : "Tue Dec 28 2010 17:03:19 GMT+0100 (CET)", "created" : "Tue Dec 28 2010 17:03:19 GMT+0100 (CET)" }[/bash].

Ora lasciamo perdere cakephp, diamo un occhio ad un altra cosa davvero belle in MongoDB. Geospatial index.
Geospatial ci permette di gestire facilmente una collection di coordinate. <a href="http://www.mongodb.org/display/DOCS/Geospatial+Indexing">Qua</a> maggiori info a riguardo.
All'interno di questo esempio vengono utilizzati i seguenti operatori.
$near per trovare un punto vicino ad un altro
$box per trovare i punti all'interno di un rettangolo
$center per trovare punti all'interno di un cerchio
Salviamo due coordinate dalla console, ricordiamoci che in mongo db non abbiamo bisogno di definire uno schema prima di inserirre dati.
[bash]
db.geotest.save({ loc:[23,113] })
[/bash]
poi diamo un indice alla collection, in questo caso 2d, che sta per 2 dimensions
[bash]db.geotest.ensureIndex({ loc:"2d"})[/bash]
Ora inseriamo un centinaio di punti, sempre da console
[bash]for(i=0; i&lt;100; i++) (db.geotest.save ({loc:[i,i]}))[/bash]
verifichiamo di avere inserito tutto
[bash]db.geotest.find()[/bash]
Proviamo ad utilizzare gli operatori citati prima per identificare un punto.
[bash]db.geotest.find( { loc : { $near : [50,50] } } )[/bash]
Aggiungere un limite alla nostra ricerca in mongodb viene intuitivo
[bash]db.geotest.find( { loc : { $near : [50,50] } } ).limit(6)[/bash]
Troviamo i nostri punti all'interno di un rettangolo
[bash]db.geotest.find( { loc : { $within : { $box : [[1,1],[5,5]] } } } )[/bash]
O partendo da un punto
[bash]db.geotest.find( { loc : { $within : { $center : [[4,4],0.1] } } } )[/bash]
Il secondo valore definisce il raggio, se lo aumentate avrete logicamente un maggior numero di risultati
[bash]db.geotest.find( { loc : { $within : { $center : [[4,4],5] } } } )[/bash] 

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/2010/12/09/implementare-security-component-e-ssl-con-cakephp" title="Implementare Security Component e SSL con CakePHP">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/2011/01/13/parsing-dei-link-da-un-file-html-con-ruby-e-nokogiri" title="Parsing dei link da un file html con Ruby e Nokogiri">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'jekyllbootstrap'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
  
  <div class="span4">
    <h4>Published</h4>
    <div class="date"><span>28 December 2010</span></div>

  
    <h4>Tags</h4>
    <ul class="tag_box">
    
    


  
     
    	<li><a href="/tags.html#cakephp-ref">cakephp <span>20</span></a></li>
    
  



    </ul>
    
  </div>
</div>


      </div>

      <footer>
        <p>&copy; Name Lastname 2012 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div> <!-- /container -->

    
  </body>
</html>

