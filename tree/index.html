<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barking dog</title>
    <script id="vertexShader" type="x-shader/x-vertex">
      varying vec3 vNormal;
      uniform float amplitude;
      attribute float displacement;

      void main() {
        // set the vNormal value with
        // the attribute value passed
        // in by Three.js
        vNormal = normal;
        //vec3 newPosition = position + normal * vec3(amplitude * displacement);
        vec3 newPosition = position + amplitude * normal * vec3( displacement );

        gl_Position = projectionMatrix *
                      modelViewMatrix *
                      vec4(newPosition, 1.0);
      }
    </script>

    <script id="fragmentShader" type="x-shader/x-vertex">
      // fog's constant and functions
      #define LOG2 1.442695
      #define saturate(a) clamp( a, 0.0, 1.0 )
      #define whiteCompliment(a) ( 1.0 - saturate( a ) )

      varying vec3 vNormal;
      uniform vec3 color;
      uniform float fogDensity;
      uniform vec3 fogColor;

      void main() {
        vec3 light = vec3(0.5, 0.2, 0.5);
        light = normalize(light);
        // calculate the dot product of
        // the light to the vertex normal
        // higher
        // float dProd = dot( vNormal, light ) * 0.5 + 0.5;
        // lower
        float dProd = max(0.0,dot(vNormal, light));

        // black and white
        //vec4 col = vec4(dProd, dProd, dProd, 1.0);
        // colors
        vec4 col = vec4( vec3( dProd ) * vec3( color ), 1.0 );

        #ifdef USE_FOG // only FogExp2 is implemented
          vec3 outgoingLight = vec3( 0.0 );
          float depth = gl_FragCoord.z / gl_FragCoord.w;
          float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );
          gl_FragColor.rgb = mix( col.rgb, fogColor, fogFactor );
        #else
          gl_FragColor = col;
        #endif
        }
    </script>
  </head>
  <body>
    <div id="container"></div>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/three.js/r77/three.min.js"></script>
    <script type="text/javascript" src="PLYLoader.js"></script>
    <script type="text/javascript" src="OBJLoader.js"></script>
    <script type="text/javascript" src="jquery-2.2.4.min.js"></script>
    <script src="https://dl.dropboxusercontent.com/u/3587259/Code/Threejs/OrbitControls.js"></script>
    <script type="text/javascript" src="index.js"></script>
    <script type="text/javascript" src="stats.min.js"></script>
    <link rel="stylesheet" type="text/css" href="assets/style.css">
  </body>
</html>
