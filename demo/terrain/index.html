<html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>plane</title>
  </head>
  <body >
    <div id="container"></div>
    <script id="vertexShader" type="x-shader/x-vertex">
    uniform sampler2D bumpTexture;
    uniform float bumpScale;
    varying float vAmount;
    varying vec2 vUV;

    // via http://www.iquilezles.org/www/articles/functions/functions.htm
    float almostIdentity( float x, float m, float n ) {
        if( x>m ) return x;

        float a = 2.0*n - m;
        float b = 2.0*m - 3.0*n;
        float t = x/m;

        return (a*t + b)*t*t + n;
    }

    void main() {
      vUV = uv;
      vec4 bumpData = texture2D( bumpTexture, vUV );
      vAmount = almostIdentity(bumpData.r, 0.009, 0.02);
      // bumpData.r => assuming map is grayscale it doesn't matter if you use r, g, or b.

      // move the position along the normal
      vec3 newPosition = position + normal * bumpScale * vAmount;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );
    }
    </script>

    <script id="fragmentShader" type="x-shader/x-vertex">
      varying vec2 vUV;
      varying float vAmount;
      uniform sampler2D grassTexture;
      uniform sampler2D rockBottomTexture;
      uniform sampler2D rockTopTexture;

      void main() {
        //uncomment for colors
        //vec3 color = vec3( vUV * ( 1. - 0.5 * vAmount ), 0.0 );
        //gl_FragColor = vec4( color.rgb, 1.0 );
        //black and white
        //gl_FragColor = vec4(vAmount * 1.);
        vec4 grass = (smoothstep(0.003, 0.01, vAmount) - smoothstep(0.006, 0.1, vAmount)) * texture2D( grassTexture, vUV * 20.0 );
        vec4 rocky = (smoothstep(0.01, 0.15, vAmount) - smoothstep(0.30, 0.55, vAmount)) * texture2D( rockBottomTexture, vUV * 20.0 );
        vec4 snowy = (smoothstep(0.35, 0.65, vAmount))                                   * texture2D( rockTopTexture, vUV * 10.0 );
        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0) + grass + rocky + snowy;

      }
    </script>

    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/three.js/r77/three.min.js"></script>
    <script type="text/javascript" src="../js/dat.gui.min.js"></script>
    <script type="text/javascript" src="../js/OrbitControls.js"></script>
    <script type="text/javascript" src="../js/stats.min.js"></script>
    <script type="text/javascript" src="../js/SVGLoader.js"></script>
    <script type="text/javascript" src="../js/jquery-2.2.4.min.js"></script>

    <script type="text/javascript" src="index.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">


</body></html>
