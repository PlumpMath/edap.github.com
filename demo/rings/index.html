<html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rings</title>
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body>
    <div id="spinner"></div>
    <div id="container"></div>

    <script id="vertexShaderTree" type="x-shader/x-vertex">
      precision mediump float;
      varying vec3 vNormal;
      varying vec3 vPos;
      varying float vFuck;
      uniform vec2 uResolution;

      float map(float x, float in_min, float in_max, float out_min, float out_max){
          return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
      }

      void main() {
        vNormal = normalMatrix * normal;
        // as the light later will be given in world coordinate space,
        // vPos has to be in world coordinate space too
        vPos = (modelMatrix * vec4(position, 1.0 )).xyz;
        vFuck  = position.y/uResolution.y;
        gl_Position = projectionMatrix *
                      modelViewMatrix *
                      vec4(position, 1.0);
      }
    </script>

    <script id="fragmentShaderTree" type="x-shader/x-vertex">
      precision mediump float;
      // fog's constant and functions
      #define LOG2 1.442695
      #define saturate(a) clamp( a, 0.0, 1.0 )
      #define whiteCompliment(a) ( 1.0 - saturate( a ) )
      // Comment this line to do not use the point light
      //#define CUSTOM_POINTLIGHTS
      #define NUM_RINGS 5

      varying vec3 vNormal;
      varying vec3 vPos;
      varying float vFuck;

      uniform vec3 color;
      uniform float fogDensity;
      uniform vec3 fogColor;
      uniform float time;
      uniform float ringThickness;
      uniform vec2 uResolution;

      struct PointLight {
        vec3 position;
        vec3 color;
      };
      uniform PointLight pointLights[ NUM_POINT_LIGHTS ];

      float cubicPulse( float c, float w, float x ){
          x = abs(x - c);
          if( x>w ) return 0.0;
          x /= w;
          return 1.0 - x*x*(3.0-2.0*x);
      }

      void main() {

        //vec2 screenUv = gl_FragCoord.xy/vForestResolution ;
        #ifdef CUSTOM_POINTLIGHTS
          vec4 addedLights = vec4(0.5,0.2,0.5, 1.0);
          for(int l = 0; l < NUM_POINT_LIGHTS; l++) {
            vec3 adjustedLight = pointLights[l].position + cameraPosition;
            vec3 lightDirection = normalize(vPos - adjustedLight);
            addedLights.rgb += clamp(dot(-lightDirection, vNormal), 0.0, 1.0) * pointLights[l].color;
          }

          float inc = 1.0/float(NUM_RINGS);
          float padding = 0.0;
          vec4 rcolor = vec4(color, 1.0);

          for (int i = 0; i< NUM_RINGS; i++) {
              float y = cubicPulse(mod(time * 0.12, 1.0),ringThickness,vFuck - padding);
              rcolor += vec4(vec3(1.0,0.0,0.0) * vec3(y), 1.0);
              padding += inc;
          }
          vec4 col = mix(vec4(rcolor.xyz, 1.0), addedLights, addedLights);
        #else
          vec3 light = vec3(0.5, 0.2, 0.5);
          light = normalize(light);
          float dProd = max(0.0,dot(vNormal, light));
          vec3 ringCol = vec3(1.0,0.0,0.0);
          float y = cubicPulse(mod(time*0.2, 1.0),ringThickness,vFuck);
          // use simple fixed light, or
          //vec4 col = vec4( vec3( dProd ) * vec3( y ) * ringCol, 1.0 );
          vec4 col = vec4( vec3( y ) * ringCol, 1.0 );
        #endif

        #ifdef USE_FOG // only FogExp2 is implemented
          float depth = gl_FragCoord.z / gl_FragCoord.w;
          float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );
          gl_FragColor.rgb = mix( col.rgb, fogColor, fogFactor );
        #else
          gl_FragColor = col;
          //gl_FragColor = vec4(col, 1.0);
        #endif
        }
    </script>


    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/three.js/r77/three.min.js"></script>
    <script type="text/javascript" src="../js/maxiLib.js"></script>
    <script type="text/javascript" src="../js/dat.gui.min.js"></script>
    <script type="text/javascript" src="../js/OrbitControls.js"></script>
    <script type="text/javascript" src="../js/stats.min.js"></script>
    <script type="text/javascript" src="../js/PLYLoader.js"></script>
    <script type="text/javascript" src="../js/jquery-2.2.4.min.js"></script>

    <script type="text/javascript" src="index.js"></script>


</body></html>
